# 插画故事生成系统

这是一个基于Gemini API的插画故事生成系统，可以一键生成包含插画和文字的连贯故事。

## 系统架构

### 核心类

1. **StoryPage** - 表示故事的一页
   - 包含页面文本、插画、生成状态等信息
   - 提供页面完整性检查和资源清理功能

2. **StoryData** - 存储完整故事数据
   - 管理故事的基本信息（标题、主题、页数等）
   - 跟踪生成进度和完成状态
   - 提供故事摘要和资源管理

3. **StoryGenerator** - 核心生成逻辑
   - 调用Gemini API生成故事大纲
   - 为每页生成文本内容和插画提示词
   - 调用Imagen API生成插画
   - 处理生成过程中的错误和重试
   - 通过事件通知进度更新

4. **StoryManager** - 业务逻辑管理
   - 管理故事生成流程
   - 处理故事的保存和加载
   - 通过事件与UI层通信
   - 不包含UI相关代码

### UI层类

5. **StoryUILayer** - 故事生成UI（继承UILayer）
   - 处理故事生成的用户输入
   - 显示生成进度和状态
   - 订阅StoryManager的事件

6. **StoryDisplayLayer** - 故事显示UI（继承UILayer）
   - 显示完整的故事内容
   - 提供页面滚动和导航功能
   - 处理故事的保存和分享

## 使用方法

### 1. 设置组件

#### 业务逻辑层
1. 在场景中创建一个GameObject，添加`StoryManager`组件
2. 在Inspector中设置`StoryGenerator`引用
3. 确保`GeminiClient`和`Imagen4`组件已正确配置API Key

#### UI层设置
1. 创建故事生成UI页面，添加`StoryUILayer`组件
2. 设置UI组件引用（InputField、Button、Slider等）
3. 设置`StoryManager`引用
4. 创建故事显示UI页面，添加`StoryDisplayLayer`组件
5. 设置故事显示相关的UI组件

### 2. 配置API

确保`GeminiClient`和`Imagen4`组件已正确配置API Key。

### 3. 生成故事

1. 在`StoryUILayer`中输入：
   - 故事标题
   - 故事主题
   - 页数（1-20页）
2. 点击"生成故事"按钮
3. 等待生成完成

### 4. 查看结果

生成完成后，可以通过`StoryDisplayLayer`查看完整故事，包括：
- 每页的文本内容
- 对应的插画
- 页面导航功能
- 保存和分享功能

## 功能特性

- **智能故事生成**：基于标题和主题生成连贯的故事大纲
- **自动插画生成**：为每页自动生成匹配的插画
- **进度跟踪**：实时显示生成进度
- **错误处理**：包含重试机制和错误提示
- **资源管理**：自动清理生成的资源
- **保存/加载**：支持故事的保存和加载
- **UI分离**：业务逻辑与UI显示完全分离
- **事件驱动**：通过事件系统实现松耦合通信
- **模块化设计**：每个类职责明确，易于维护和扩展

## 注意事项

1. 确保API Key已正确配置
2. 生成过程可能需要较长时间，请耐心等待
3. 建议页数控制在1-20页之间
4. 生成的故事会自动保存到本地

## 扩展功能

可以通过以下方式扩展系统：

1. **自定义风格**：修改`StoryGenerator`中的`storyStyle`参数
2. **添加更多主题**：扩展主题选择功能
3. **导出功能**：添加PDF或其他格式的导出
4. **分享功能**：添加社交分享功能
